!function(){"use strict";var e,t,a=new showdown.Converter,n=0,r=0,o=Date.now();const l=["DIV","P","UL","OL","H1","H2","H3","H4","H5","H6","SMALL"],c=["P","UL","OL","H1","H2","H3","H4","H5","H6","SMALL","B","I","U","A","STRIKE","SUP","SUB"],s=["<p>It was a dark and stormy night . . .</p>","<p>Psst . . . remember to save your work to your computer! LocalStorage can be unreliable.</p>",'<p>If you find a bug or would like to request a feature, please submit an issue on GitHub: <a href="https://github.com/DogCatPuppyLover/typewriter/issues">https://github.com/DogCatPuppyLover/typewriter/issues</a></p>',"<p>Thank you for using Typewriter! <3</p>","<p>Never gonna give you up</p><p>Never gonna let you down</p><p>Never gonna run around and desert you</p><p>Never gonna make you cry</p><p>Never gonna say goodbye</p><p>Never gonna tell a lie and hurt you</p>","Lorem ipsum dolor sit amet, consectetur adipiscing elit."];var u=[],i=[],m=[],d=[],p=[];const f=document.getElementsByTagName("html")[0],g=document.getElementById("editor"),y=document.getElementById("toolbox"),h=document.getElementById("preferences-modal"),v=document.getElementById("preferences-form"),b=new Audio("assets/audio/typewriter keystroke.mp3"),k=new Audio("assets/audio/typewriter keystroke.mp3"),w=new Audio("assets/audio/typewriter space.mp3"),L=new Audio("assets/audio/typewriter linebreak.mp3"),E=new Audio("assets/audio/typewriter backspace.mp3"),S=new Audio("assets/audio/typewriter paper in.mp3"),D=new Audio("assets/audio/typewriter paper out.mp3");if(b.volume=.1,k.volume=.1,document.execCommand("defaultParagraphSeparator",!1,"p"),document.execCommand("insertBrOnReturn",!1,!1),document.execCommand("styleWithCSS",!1,!1),g.focus(),document.querySelectorAll('#preferences-form input[type="checkbox"]').forEach(e=>{u.push(e.getAttribute("name"))}),document.querySelectorAll('#preferences-form input[type="radio"]').forEach(e=>{let t=e.getAttribute("name");i.includes(t)||i.push(t)}),Array.from(v.getElementsByTagName("textarea")).forEach(e=>{m.push(e.getAttribute("name"))}),document.querySelectorAll('#preferences-form input[type="radio"][name="theme"]').forEach(e=>{d.push(e.getAttribute("value"))}),document.querySelectorAll('#preferences-form input[type="radio"][name="font"]').forEach(e=>{p.push(e.getAttribute("value"))}),null===localStorage.getItem("preferences")&&(["userStyles","hideMouse","spellcheck","typewriterSounds","focusMode"].forEach(e=>{"userStyles"===e&&null!=localStorage.getItem("userStyles")&&""!=localStorage.getItem("userStyles")&&(document.getElementById("user-styles").value=localStorage.getItem("userStyles")),localStorage.removeItem(e)}),M()),C(),Object.keys(t).forEach(e=>{u.includes(e)?document.querySelector('[name="'+e+'"]').checked="true"===t[e]:i.includes(e)?document.querySelector('[name="'+e+'"][value="'+t[e]+'"]').checked=!0:m.includes(e)&&(document.querySelector('[name="'+e+'"]').value=t[e])}),null===localStorage.getItem("file_0"))localStorage.setItem("file_0",H(g.innerHTML)),B(0);else{let e=0;for(;null!==localStorage.getItem("file_"+e);)B(e),e++}function I(){localStorage.setItem("file_"+n,H(g.innerHTML)),o=Date.now(),console.log("Autosaved")}function x(e,t,a){var n=new Blob([t],{type:a});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(n,e);else{let t=window.document.createElement("a");t.href=window.URL.createObjectURL(n),t.download=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}"true"==localStorage.getItem("typewriter-sounds")&&D.play()}function A(){for(var e=0;null!==localStorage.getItem("file_"+e);)e++;localStorage.setItem("file_"+e,11==(new Date).getMonth()&&25==(new Date).getDate()?"Merry Christmas! 🎄":11==(new Date).getMonth()&&31==(new Date).getDate()?"Happy New Year's Eve! 🎉":0==(new Date).getMonth()&&1==(new Date).getDate()||0==(new Date).getMonth()&&1==(new Date).getDate()?"Happy New Year's! 🎉":5==(new Date).getMonth()&&Math.random()>.1?"Happy Pride Month! 🏳️‍🌈":s[Math.floor(Math.random()*s.length)]),B(e),T(e)}function T(e){var t=document.getElementById("file_"+n),a=document.getElementById("file_"+e);n=e,g.innerHTML=H(localStorage.getItem("file_"+e)),t.classList.remove("activeTab"),a.classList.add("activeTab"),a.scrollIntoView(),N(document)}function B(e){var t=document.createElement("button");t.innerHTML="File "+(e+1),t.id="file_"+e,t.className="tab",t.onclick=()=>{T(e)},document.getElementById("tabs").appendChild(t),document.getElementById("newfile").scrollIntoView()}function M(){var e=new FormData(v),t={};u.forEach(t=>{e.has(t)?e.set(t,"true"):e.append(t,"false")});for(let a of e)t[a[0]]=a[1];localStorage.setItem("preferences",JSON.stringify(t))}function C(){"true"==(t=JSON.parse(localStorage.getItem("preferences")))["focus-mode"]?g.classList.add("focus-mode"):g.classList.remove("focus-mode"),g.setAttribute("spellcheck",t.spellcheck),d.forEach(e=>{f.classList.remove(e)}),p.forEach(e=>{f.classList.remove(e)}),f.classList.add(t.theme),f.classList.add(t.font),document.getElementById("user-styles-element").innerHTML=t["user-styles"]}function H(e){let t=document.createElement("div");var a,n;t.innerHTML=e,a=t,n=["href"],Array.from(a.getElementsByTagName("*")).forEach(e=>{Array.from(e.attributes).forEach(t=>{n.includes(t.name)||e.removeAttribute(t.name)})}),function(e,t){Array.from(e.getElementsByTagName("*")).forEach(e=>{""!=e.innerHTML||t.includes(e.tagName)||e.remove()})}(t,["img"]),function(e){Array.from(e.getElementsByTagName("*")).forEach(e=>{c.includes(e.tagName)||e.remove()})}(t);let r=t.innerHTML;if(r.includes("<br>")){let e=r.split("<br>"),t="";for(let a=0;a<e.length;a++)t+="<p>"+e[a]+"</p>";r=t}return r=r.replace(/<div>/gi,"<p>").replaceAll(/<\/div>/gi,"</p>").replace(/\s{2,}/g," ").replaceAll("\n","").trim(),r}function N(e){e.querySelectorAll(".editable-focus").forEach(e=>{e.classList.remove("editable-focus"),0==e.classList.length&&e.removeAttribute("class")})}function _(e,t,a){e.currentTime=0,e.volume=Math.min(t+a*(Math.random()-.5),1),e.play()}function q(e){e.classList.remove("modal-open")}function O(){document.body.style.cursor="auto",f.classList.remove("hide-scrollbars"),y.classList.remove("quick-fade-out")}T(0),y.removeAttribute("hidden"),"true"==t["typewriter-sounds"]&&S.play(),document.addEventListener("keydown",e=>{if("true"==t["typewriter-sounds"])switch(e.key){case"Enter":_(L,1.5,1);break;case" ":_(w,1.5,1);break;case"Backspace":_(E,1.5,1);break;default:_(r%2==0?b:k,.3,.2),r++}let o=((window.navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?"ctrl + ":"")+(e.altKey?"alt + ":"")+(e.shiftKey?"shift + ":"")+e.key.toLowerCase();if("Escape"==e.key){let e=document.getElementsByClassName("modal-open"),t=e[e.length-1];null!=t&&q(t)}if("Tab"==e.key&&O(),g.contains(e.target))switch(o){case"ctrl + s":e.preventDefault(),function(){var e=prompt("Enter filename:","typewriter-file"+(n+1)+".html");if(null!==e){let t=e.split(".");switch(t[t.length]){case"html":x(e,g.innerHTML,"text/html");break;case"txt":x(e,g.innerText,"text/plain");break;case"md":x(e,a.makeMarkdown(g.innerHTML));break;default:x(e,g.innerText,"text/plain")}}}();break;case"ctrl + o":e.preventDefault(),document.getElementById("file-item").click();break;case"ctrl + b":e.preventDefault(),document.execCommand("bold",!1,null);break;case"ctrl + i":e.preventDefault(),document.execCommand("italic",!1,null);break;case"ctrl + 0":e.preventDefault(),document.execCommand("formatBlock",!1,"<p>");break;case"ctrl + 1":e.preventDefault(),document.execCommand("formatBlock",!1,"<h1>");break;case"ctrl + 2":e.preventDefault(),document.execCommand("formatBlock",!1,"<h2>");break;case"ctrl + 3":e.preventDefault(),document.execCommand("formatBlock",!1,"<h3>");break;case"ctrl + 4":e.preventDefault(),document.execCommand("formatBlock",!1,"<h4>");break;case"ctrl + u":e.preventDefault(),document.execCommand("underline",!1,null);break;case"ctrl + k":e.preventDefault();var l=prompt('Where should the text link to? (type "null" to unlink)');null!==l&&("null"==l?document.execCommand("unlink",!1,null):document.execCommand("createLink",!1,l));break;case"ctrl + \\":e.preventDefault(),document.execCommand("removeFormat",!1,null);break;case"ctrl + alt + -":e.preventDefault(),document.execCommand("strikeThrough",!1,null);break;case"ctrl + shift + <":e.preventDefault(),document.execCommand("subscript",!1,null);break;case"ctrl + shift + >":e.preventDefault(),document.execCommand("superscript",!1,null);break;case"ctrl + shift + l":e.preventDefault(),document.execCommand("insertOrderedList",!1,null);break;case"ctrl + alt + l":e.preventDefault(),document.execCommand("insertUnorderedList",!1,null);break;case"ctrl + alt + r":e.preventDefault(),document.execCommand("insertHorizontalRule",!1,null);break;case"ctrl + alt + s":e.preventDefault();let t=!1;Array.from(document.getElementsByTagName("small")).forEach(e=>{window.getSelection().containsNode(e,!0)&&(t=!0)}),!1===t&&document.execCommand("insertHTML",!1,"<small>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</small>");break;case"ctrl + shift + ?":e.preventDefault(),alert("hi")}}),g.addEventListener("input",a=>{clearTimeout(e),Date.now()-o>2e3?I():e=setTimeout(I,500),"false"!==t["hide-ui"]&&(document.body.style.cursor="none",f.classList.add("hide-scrollbars"),y.classList.add("quick-fade-out"))}),document.body.addEventListener("mousemove",O),v.addEventListener("submit",e=>{e.preventDefault(),M(),C(),q(h)}),document.addEventListener("selectionchange",(function(){N(document);var e=window.getSelection();if(window.getSelection&&e.rangeCount){for(var t=e.getRangeAt(0).commonAncestorContainer;!(null==t||t.ELEMENT_NODE&&l.includes(t.tagName));)t=t.parentNode;null!=t&&(t.classList.add("editable-focus"),t)}})),addEventListener("beforeunload",()=>{H(g.innerHTML)!=localStorage.getItem("file_"+n)&&I()}),document.getElementById("preferences-button").addEventListener("click",()=>{h.classList.add("modal-open")}),document.getElementById("close-preferences-button").addEventListener("click",()=>{q(h)}),document.getElementById("newfile").addEventListener("click",A),document.getElementById("file-item").addEventListener("change",(function(){A();const e=new FileReader;var t=document.getElementById("file-item").files[0];e.readAsText(t),e.onload=function(e){var n=e.target.result,r=t.name.split("."),o=r[r.length];function l(){let t="";for(let a=0;a<n.split(/\n|\n\r|\r/).length;a++)t=t+"<p>"+e.target.result.split(/\n|\n\r|\r/)[a]+"</p>";g.innerHTML=t}function c(){n=H(n),g.innerHTML=n}function s(){g.innerHTML=a.makeHtml(n)}switch(t.type){case"text/x-markdown":s();break;case"text/html":c();break;case"text/plain":l();break;default:switch(o){case"md":s();break;case"html":case"htm":case"mhtml":c();break;case"txt":l();break;default:g.innerText=n}}I(),"true"==localStorage.getItem("typewriter-sounds")&&S.play()}}))}();