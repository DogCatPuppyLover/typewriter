!function(){"use strict";var e,t,a=new showdown.Converter,n=0,r=0,o=Date.now();const l=["DIV","P","UL","OL","H1","H2","H3","H4","H5","H6","SMALL"],c=["P","UL","OL","LI","H1","H2","H3","H4","H5","H6","SMALL","B","I","U","A","STRIKE","SUP","SUB"],s=["<p>It was a dark and stormy night . . .</p>","<p>Psst . . . remember to save your work to your computer! LocalStorage can be unreliable.</p>",'<p>If you find a bug or would like to request a feature, please submit an issue on GitHub: <a href="https://github.com/DogCatPuppyLover/typewriter/issues">https://github.com/DogCatPuppyLover/typewriter/issues</a></p>',"<p>Thank you for using Typewriter! <3</p>","<p>Never gonna give you up</p><p>Never gonna let you down</p><p>Never gonna run around and desert you</p><p>Never gonna make you cry</p><p>Never gonna say goodbye</p><p>Never gonna tell a lie and hurt you</p>","Lorem ipsum dolor sit amet, consectetur adipiscing elit.","<p>I have no memory of this place. Uh Were-worms beings starlight stink laddie watchtower outlast. Maids moon separate interrupt pleased asleep forebears forfeit cat draught o'clock Girion. Riding lands Bilbo Baggins concealment arm unwise. Others fulfilled Rohirrim? Absolutely won't antagonize delved wizard Dwarf-city despair riddles ill-favored beacon. Grond nonsense deny. Let's break paths mustn't yearns cry baby tall hundreds head-on Saruman's scent. Emerald beg limited Balrog improve hunted. (Generated with <a href=\"https://lotremipsum.com/result-basic.php\">LOTRem Ipsum</a>)</p>"];var i=[],u=[],m=[],d=[],p=[];const f=document.getElementsByTagName("html")[0],g=document.getElementById("editor"),y=document.getElementById("toolbox"),h=document.getElementById("preferences-modal"),v=document.getElementById("preferences-form"),b=new Audio("assets/audio/typewriter keystroke.mp3"),w=new Audio("assets/audio/typewriter keystroke.mp3"),k=new Audio("assets/audio/typewriter space.mp3"),L=new Audio("assets/audio/typewriter linebreak.mp3"),E=new Audio("assets/audio/typewriter backspace.mp3"),S=new Audio("assets/audio/typewriter paper in.mp3"),D=new Audio("assets/audio/typewriter paper out.mp3");if(b.volume=.1,w.volume=.1,document.execCommand("defaultParagraphSeparator",!1,"p"),document.execCommand("insertBrOnReturn",!1,!1),document.execCommand("styleWithCSS",!1,!1),g.focus(),document.querySelectorAll('#preferences-form input[type="checkbox"]').forEach(e=>{i.push(e.getAttribute("name"))}),document.querySelectorAll('#preferences-form input[type="radio"]').forEach(e=>{let t=e.getAttribute("name");u.includes(t)||u.push(t)}),Array.from(v.getElementsByTagName("textarea")).forEach(e=>{m.push(e.getAttribute("name"))}),document.querySelectorAll('#preferences-form input[type="radio"][name="theme"]').forEach(e=>{d.push(e.getAttribute("value"))}),document.querySelectorAll('#preferences-form input[type="radio"][name="font"]').forEach(e=>{p.push(e.getAttribute("value"))}),null===localStorage.getItem("preferences")&&(["userStyles","hideMouse","spellcheck","typewriterSounds","focusMode"].forEach(e=>{"userStyles"===e&&null!=localStorage.getItem("userStyles")&&""!=localStorage.getItem("userStyles")&&(document.getElementById("user-styles").value=localStorage.getItem("userStyles")),localStorage.removeItem(e)}),H()),A(),Object.keys(t).forEach(e=>{i.includes(e)?document.querySelector('[name="'+e+'"]').checked="true"===t[e]:u.includes(e)?document.querySelector('[name="'+e+'"][value="'+t[e]+'"]').checked=!0:m.includes(e)&&(document.querySelector('[name="'+e+'"]').value=t[e])}),null===localStorage.getItem("file_0"))localStorage.setItem("file_0",C(g.innerHTML)),B(0);else{let e=0;for(;null!==localStorage.getItem("file_"+e);)B(e),e++}function I(){localStorage.setItem("file_"+n,C(g.innerHTML)),o=Date.now(),console.log("Autosaved")}function T(e,t,a){var n=new Blob([t],{type:a});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(n,e);else{let t=window.document.createElement("a");t.href=window.URL.createObjectURL(n),t.download=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}"true"==localStorage.getItem("typewriter-sounds")&&D.play()}function M(){for(var e=0;null!==localStorage.getItem("file_"+e);)e++;localStorage.setItem("file_"+e,11==(new Date).getMonth()&&25==(new Date).getDate()?"Merry Christmas! ðŸŽ„":11==(new Date).getMonth()&&31==(new Date).getDate()?"Happy New Year's Eve! ðŸŽ‰":0==(new Date).getMonth()&&1==(new Date).getDate()||0==(new Date).getMonth()&&1==(new Date).getDate()?"Happy New Year's! ðŸŽ‰":5==(new Date).getMonth()&&Math.random()>.1?"Happy Pride Month! ðŸ³ï¸â€ðŸŒˆ":s[Math.floor(Math.random()*s.length)]),B(e),x(e)}function x(e){var t=document.getElementById("file_"+n),a=document.getElementById("file_"+e);n=e,g.innerHTML=C(localStorage.getItem("file_"+e)),t.classList.remove("activeTab"),a.classList.add("activeTab"),a.scrollIntoView(),N(document)}function B(e){var t=document.createElement("button");t.innerHTML="File "+(e+1),t.id="file_"+e,t.className="tab",t.onclick=()=>{x(e)},document.getElementById("tabs").appendChild(t),document.getElementById("newfile").scrollIntoView()}function H(){var e=new FormData(v),t={};i.forEach(t=>{e.has(t)?e.set(t,"true"):e.append(t,"false")});for(let a of e)t[a[0]]=a[1];localStorage.setItem("preferences",JSON.stringify(t))}function A(){"true"==(t=JSON.parse(localStorage.getItem("preferences")))["focus-mode"]?g.classList.add("focus-mode"):g.classList.remove("focus-mode"),g.setAttribute("spellcheck",t.spellcheck),d.forEach(e=>{f.classList.remove(e)}),p.forEach(e=>{f.classList.remove(e)}),f.classList.add(t.theme),f.classList.add(t.font),document.getElementById("user-styles-element").innerHTML=t["user-styles"]}function C(e){let t=document.createElement("div");t.innerHTML=e;let a=t.innerHTML;if(a.includes("<br>")){let e=a.split("<br>"),t="";for(let a=0;a<e.length;a++)t+="<p>"+e[a]+"</p>";a=t}var n,r;return t.innerHTML=a,n=t,r=["href"],Array.from(n.getElementsByTagName("*")).forEach(e=>{Array.from(e.attributes).forEach(t=>{r.includes(t.name)||e.removeAttribute(t.name)})}),function(e,t){Array.from(e.getElementsByTagName("*")).forEach(e=>{""!=e.innerHTML||t.includes(e.tagName)||e.remove()})}(t,["img"]),a=t.innerHTML,a=a.replace(/<div>/gi,"<p>").replace(/<\/div>/gi,"</p>").replace(/<strong>/gi,"<b>").replace(/<\/strong>/gi,"</b>").replace(/<em>/gi,"<i>").replace(/<\/em>/gi,"</i>"),t.innerHTML=a,function(e){Array.from(e.getElementsByTagName("*")).forEach(e=>{c.includes(e.tagName)||e.remove()})}(t),a=t.innerHTML.replace(/\s{2,}/g," ").replaceAll("\n","").trim(),a}function N(e){e.querySelectorAll(".editable-focus").forEach(e=>{e.classList.remove("editable-focus"),0==e.classList.length&&e.removeAttribute("class")})}function O(e,t,a){e.currentTime=0,e.volume=Math.min(t+a*(Math.random()-.5),1),e.play()}function _(e){e.classList.remove("modal-open")}function q(){document.body.style.cursor="auto",f.classList.remove("hide-scrollbars"),y.classList.remove("quick-fade-out")}x(0),y.removeAttribute("hidden"),"true"==t["typewriter-sounds"]&&S.play(),document.addEventListener("keydown",e=>{if("true"==t["typewriter-sounds"])switch(e.key){case"Enter":O(L,1.5,1);break;case" ":O(k,1.5,1);break;case"Backspace":O(E,1.5,1);break;default:O(r%2==0?b:w,.3,.2),r++}let o=((window.navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?"ctrl + ":"")+(e.altKey?"alt + ":"")+(e.shiftKey?"shift + ":"")+e.key.toLowerCase();if("Escape"==e.key){let e=document.getElementsByClassName("modal-open"),t=e[e.length-1];null!=t&&_(t)}if("Tab"==e.key&&q(),g.contains(e.target))switch(o){case"ctrl + s":e.preventDefault(),function(){var e=prompt("Enter filename:","typewriter-file"+(n+1)+".html");if(null!==e){let t=e.split(".");switch(console.log(t),t[t.length-1]){case"html":T(e,g.innerHTML,"text/html");break;case"txt":T(e,g.innerText,"text/plain");break;case"md":T(e,a.makeMarkdown(g.innerHTML));break;default:T(e,g.innerText,"text/plain")}}}();break;case"ctrl + o":e.preventDefault(),document.getElementById("file-item").click();break;case"ctrl + b":e.preventDefault(),document.execCommand("bold",!1,null);break;case"ctrl + i":e.preventDefault(),document.execCommand("italic",!1,null);break;case"ctrl + 0":e.preventDefault(),document.execCommand("formatBlock",!1,"<p>");break;case"ctrl + 1":e.preventDefault(),document.execCommand("formatBlock",!1,"<h1>");break;case"ctrl + 2":e.preventDefault(),document.execCommand("formatBlock",!1,"<h2>");break;case"ctrl + 3":e.preventDefault(),document.execCommand("formatBlock",!1,"<h3>");break;case"ctrl + 4":e.preventDefault(),document.execCommand("formatBlock",!1,"<h4>");break;case"ctrl + u":e.preventDefault(),document.execCommand("underline",!1,null);break;case"ctrl + k":e.preventDefault();var l=prompt('Where should the text link to? (type "null" to unlink)');null!==l&&("null"==l?document.execCommand("unlink",!1,null):document.execCommand("createLink",!1,l));break;case"ctrl + \\":e.preventDefault(),document.execCommand("removeFormat",!1,null);break;case"ctrl + alt + -":e.preventDefault(),document.execCommand("strikeThrough",!1,null);break;case"ctrl + shift + <":e.preventDefault(),document.execCommand("subscript",!1,null);break;case"ctrl + shift + >":e.preventDefault(),document.execCommand("superscript",!1,null);break;case"ctrl + shift + l":e.preventDefault(),document.execCommand("insertOrderedList",!1,null);break;case"ctrl + alt + l":e.preventDefault(),document.execCommand("insertUnorderedList",!1,null);break;case"ctrl + alt + r":e.preventDefault(),document.execCommand("insertHorizontalRule",!1,null);break;case"ctrl + alt + s":e.preventDefault();let t=!1;Array.from(document.getElementsByTagName("small")).forEach(e=>{window.getSelection().containsNode(e,!0)&&(t=!0)}),!1===t&&document.execCommand("insertHTML",!1,"<small>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</small>");break;case"ctrl + shift + ?":e.preventDefault(),alert("hi")}}),g.addEventListener("input",a=>{clearTimeout(e),Date.now()-o>2e3?I():e=setTimeout(I,500),"false"!==t["hide-ui"]&&(document.body.style.cursor="none",f.classList.add("hide-scrollbars"),y.classList.add("quick-fade-out"))}),document.body.addEventListener("mousemove",q),v.addEventListener("submit",e=>{e.preventDefault(),H(),A(),_(h)}),document.addEventListener("selectionchange",(function(){N(document);var e=window.getSelection();if(window.getSelection&&e.rangeCount){for(var t=e.getRangeAt(0).commonAncestorContainer;!(null==t||t.ELEMENT_NODE&&l.includes(t.tagName));)t=t.parentNode;null!=t&&(t.classList.add("editable-focus"),t)}})),addEventListener("beforeunload",()=>{C(g.innerHTML)!=localStorage.getItem("file_"+n)&&I()}),document.getElementById("preferences-button").addEventListener("click",()=>{h.classList.add("modal-open")}),document.getElementById("close-preferences-button").addEventListener("click",()=>{_(h)}),document.getElementById("newfile").addEventListener("click",M),document.getElementById("file-item").addEventListener("change",(function(){M();const e=new FileReader;var t=document.getElementById("file-item").files[0];e.readAsText(t),e.onload=function(e){var n=e.target.result,r=t.name.split("."),o=r[r.length];function l(){let t="";for(let a=0;a<n.split(/\n|\n\r|\r/).length;a++)t=t+"<p>"+e.target.result.split(/\n|\n\r|\r/)[a]+"</p>";g.innerHTML=C(t)}function c(){n=C(n),g.innerHTML=n}function s(){g.innerHTML=C(a.makeHtml(n))}switch(t.type){case"text/x-markdown":s();break;case"text/html":c();break;case"text/plain":l();break;default:switch(o){case"md":s();break;case"html":case"htm":case"mhtml":c();break;case"txt":l();break;default:g.innerText=n}}I(),"true"==localStorage.getItem("typewriter-sounds")&&S.play()}}))}();